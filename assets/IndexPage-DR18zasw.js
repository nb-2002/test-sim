import{d as k,r as c,o as g,a as x,c as b,b as r,n as h,e as u,f as v}from"./index-Cjhssqhd.js";class f{sensorCoord=[[22,25],[27,25],[73,25],[78,25]];sensorSensed=[!1,!1,!1,!1];operation=[[[!1,!0,!0,!1],[!0,!0,!1,!1],[!0,!1,!1,!1],[!1,!0,!1,!1],[!1,!0,!0,!0],[!1,!0,!1,!0],[!0,!0,!0,!0]],[[!1,!0,!0,!1],[!1,!1,!0,!0],[!1,!1,!1,!0],[!1,!1,!0,!1],[!0,!0,!0,!1],[!0,!1,!0,!1],[!0,!0,!0,!0]]];objectRect=[[0,0],[100,0],[100,50],[0,50]];buttonClicked=!1;isPlaced=!1;runButtonClicked=!1;lastRot=0;constructor(e=[[0,25],[33,25],[66,25],[100,25]],t=[[[!1,!0,!0,!1],[!0,!0,!1,!1],[!0,!0,!1,!0],[!0,!1,!1,!1],[!1,!0,!1,!1],[!0,!0,!0,!1],[!1,!0,!1,!0],[!0,!0,!0,!0]],[[!1,!0,!0,!1],[!1,!1,!0,!0],[!1,!1,!1,!0],[!1,!1,!0,!1],[!0,!1,!0,!0],[!1,!0,!0,!0],[!0,!1,!0,!1],[!0,!0,!0,!0]],[[!0,!1,!1,!0]]]){this.sensorCoord=e,this.operation=t,this.objectRect=[[0,0],[100,0],[100,50],[0,50]],this.buttonClicked=!1,this.isPlaced=!1,this.runButtonClicked=!1}drawObject(e){if(e.context&&this.isPlaced){e.context.save(),e.context.beginPath(),e.context.strokeStyle="#505050",e.context.lineWidth=2;for(const[t,i]of this.objectRect.entries())t==0?e.context.moveTo(i[0],i[1]):e.context.lineTo(i[0],i[1]),t==3&&e.context.lineTo(this.objectRect[0][0],this.objectRect[0][1]);e.context.stroke(),e.context.closePath(),e.context.beginPath(),e.context.fillStyle="#11aa11";for(const t of[this.objectRect])e.context.arc((t[1][0]+t[0][0])/2,(t[1][1]+t[0][1])/2,4,0,Math.PI*2);e.context.fill(),e.context.closePath();for(const t of this.sensorCoord)e.context.beginPath(),e.context.fillStyle="#1111aa",e.context.arc(t[0],t[1],2,0,Math.PI*2),e.context.fill(),e.context.closePath();e.context.restore()}}buttonClick(e){this.buttonClicked=!this.buttonClicked,this.runButtonClicked=!1,e.isMoveButtonClicked=!1,e.isDrawButtonClicked=!1,this.isPlaced||(this.isPlaced=!0,this.translate(10,40),e.draw())}runButtonClick(e){this.runButtonClicked=!this.runButtonClicked,this.runButtonClicked&&this.run(e)}move(e,t){const i=[[0,-1],[1,0],[0,1],[-1,0],[0,-10],[10,0],[0,10],[-10,0],[0,-100],[100,0],[0,100],[-100,0]];for(const[o,n]of["ArrowUp","ArrowRight","ArrowDown","ArrowLeft","w","d","s","a","W","D","S","A"].entries())n==e.key&&this.translate(i[o][0],i[o][1]);const s=[-1,1,-10,10];for(const[o,n]of[",",".","<",">"].entries())n==e.key&&this.rotate(s[o]);t.draw()}run(e){const t=setInterval(()=>{this.check(e),console.log(this.sensorSensed),this.left(),this.right(),e.draw(),(!(this.sensorSensed[0]||this.sensorSensed[1]||this.sensorSensed[2]||this.sensorSensed[3])||!this.runButtonClicked)&&(clearInterval(t),this.runButtonClicked=!1)},10)}check(e){for(const[i,s]of this.sensorCoord.entries()){const o=e.context.getImageData(s[0]*e.scale+e.originX,s[1]*e.scale+e.originY,1,1);console.log(o),(o.data[0]==16||o.data[0]==17)&&(o.data[1]==16||o.data[1]==17)&&(o.data[2]==16||o.data[2]==17)?this.sensorSensed[i]=!0:this.sensorSensed[i]=!1}let t=!1;for(const i of this.operation[2]){let s=0;for(const[o,n]of i.entries())n==this.sensorSensed[o]&&s++;if(s==4){t=!0;break}}t&&this.rotate(this.lastRot)}left(){let e=!1;for(const t of this.operation[0]){let i=0;for(const[s,o]of t.entries())o==this.sensorSensed[s]&&i++;if(i==4){e=!0;break}}e&&(this.rotate(-1),this.lastRot=-1)}right(){let e=!1;for(const t of this.operation[1]){let i=0;for(const[s,o]of t.entries())o==this.sensorSensed[s]&&i++;if(i==4){e=!0;break}}e&&(this.rotate(1),this.lastRot=1)}translate(e,t){for(const i of this.objectRect)i[0]+=e,i[1]+=t;for(const i of this.sensorCoord)i[0]+=e,i[1]+=t}rotate(e){const t=e*Math.PI/180;for(const i of[this.objectRect]){const s=e>0?[(i[1][0]+i[2][0])/2,(i[1][1]+i[2][1])/2]:[(i[0][0]+i[3][0])/2,(i[0][1]+i[3][1])/2];for(const[o,n]of i.entries()){const a=[n[0]-s[0],n[1]-s[1]];i[o]=[s[0]+a[0]*Math.cos(t)-a[1]*Math.sin(t),s[1]+a[0]*Math.sin(t)+a[1]*Math.cos(t)]}for(const[o,n]of this.sensorCoord.entries()){const a=[n[0]-s[0],n[1]-s[1]];this.sensorCoord[o]=[s[0]+a[0]*Math.cos(t)-a[1]*Math.sin(t),s[1]+a[0]*Math.sin(t)+a[1]*Math.cos(t)]}}}}class d{canvas=null;context=null;scale=1;originX=0;originY=0;isDragging=!1;lastX=0;lastY=0;isMoveButtonClicked=!1;isDrawButtonClicked=!1;isTrackPointDragged=!1;arrayTrackPoints=[[[]]];atpi=0;object=new f;constructor(e){this.canvas=e}resizeCanvas(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.draw())}onWheel(e){e.preventDefault();const t=e.deltaY<0?1.1:.9;this.scale*=t;const i=e.clientX,s=e.clientY;this.originX=i-(i-this.originX)*t,this.originY=s-(s-this.originY)*t,this.draw()}onMouseDown(e){if(this.isDragging=!0,this.lastX=e.clientX,this.lastY=e.clientY,this.isDrawButtonClicked){const t=(this.lastX-this.originX)/this.scale,i=(this.lastY-this.originY)/this.scale;this.atpi==0?(this.arrayTrackPoints.length==0?this.arrayTrackPoints.push([[t,i]]):(this.arrayTrackPoints[0][0].push(t),this.arrayTrackPoints[0][0].push(i)),this.atpi++):(this.arrayTrackPoints[this.atpi-1].length<=2&&this.arrayTrackPoints[this.atpi-1].push([t,i]),this.arrayTrackPoints.push([[t,i]]),this.atpi++),this.draw()}}onMouseMove(e){if(this.isDragging&&this.isMoveButtonClicked){const t=e.clientX-this.lastX,i=e.clientY-this.lastY;this.originX+=t,this.originY+=i,this.lastX=e.clientX,this.lastY=e.clientY,this.draw()}this.isDragging&&this.isDrawButtonClicked&&(this.isTrackPointDragged=!0,this.lastX=e.clientX,this.lastY=e.clientY,this.draw())}onMouseUp(){this.isDragging=!1,this.isTrackPointDragged&&this.arrayTrackPoints[this.atpi-1].push([(this.lastX-this.originX)/this.scale,(this.lastY-this.originY)/this.scale]),this.isTrackPointDragged=!1}draw(){this.canvas&&(this.context=this.canvas.getContext("2d",{willReadFrequently:!0}))&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.translate(this.originX,this.originY),this.context.scale(this.scale,this.scale),this.drawGrid(),this.drawAxis(),this.object.drawObject(this),this.drawTrack(),this.context.restore())}drawGrid(){if(this.context){const e=50*this.scale;this.context.strokeStyle="#ccc",this.context.lineWidth=this.scale>5?1:this.scale<.2?4:2;for(let t=(Math.floor(-this.originX/e)*e-(Math.floor(this.canvas.width/50)%2?e/2:0))/this.scale;t<(this.canvas.width-this.originX)/this.scale;t+=e/this.scale)this.context.beginPath(),this.context.moveTo(t,-this.originY/this.scale),this.context.lineTo(t,(this.canvas.height-this.originY)/this.scale),this.context.stroke(),this.context.closePath();for(let t=(Math.floor(-this.originY/e)*e-(Math.floor(this.canvas.height/50)%2?e/2:0))/this.scale;t<(this.canvas.height-this.originY)/this.scale;t+=e/this.scale)this.context.beginPath(),this.context.moveTo(-this.originX/this.scale,t),this.context.lineTo((this.canvas.width-this.originX)/this.scale,t),this.context.stroke(),this.context.closePath()}}drawAxis(){this.context&&(this.context.strokeStyle="#a0a0a0",this.context.lineWidth=3,this.context.beginPath(),this.context.moveTo(Math.floor(this.canvas.width/50)/2*50,-this.originY/this.scale),this.context.lineTo(Math.floor(this.canvas.width/50)/2*50,(this.canvas.height-this.originY)/this.scale),this.context.moveTo(-this.originX/this.scale,Math.floor(this.canvas.height/50)/2*50),this.context.lineTo((this.canvas.width-this.originX)/this.scale,Math.floor(this.canvas.height/50)/2*50),this.context.stroke(),this.context.closePath())}drawTrack(){if(this.context)for(const[e,t]of this.arrayTrackPoints.entries()){if(this.isTrackPointDragged&&e==this.atpi-1){this.context.beginPath(),this.context.arc((this.lastX-this.originX)/this.scale,(this.lastY-this.originY)/this.scale,5,0,Math.PI*2),this.context.fillStyle="#1111aa",this.context.fill(),this.context.closePath();continue}t.length==2?(this.context.strokeStyle="#111111",this.context.lineWidth=50,this.context.beginPath(),this.context.moveTo(t[0][0],t[0][1]),this.context.lineTo(t[1][0],t[1][1]),this.context.stroke(),this.context.closePath()):t.length==3&&(this.context.strokeStyle="#111111",this.context.lineWidth=50,this.context.beginPath(),this.context.moveTo(t[0][0],t[0][1]),this.context.quadraticCurveTo(t[1][0],t[1][1],t[2][0],t[2][1]),this.context.stroke(),this.context.closePath()),e>0&&e<this.atpi-1&&(this.context.beginPath(),this.context.arc(t[0][0],t[0][1],25,0,Math.PI*2),this.context.fillStyle="#111111",this.context.fill(),this.context.closePath())}}centerButton(){this.originX=0,this.originY=0,this.scale=1,this.draw()}moveButtonClick(){this.object.runButtonClicked=!1,this.object.buttonClicked=!1,this.isDrawButtonClicked=!1,this.isMoveButtonClicked=!this.isMoveButtonClicked}drawButtonClick(){this.object.runButtonClicked=!1,this.object.buttonClicked=!1,this.isMoveButtonClicked=!1,this.isDrawButtonClicked=!this.isDrawButtonClicked}undoButton(){this.atpi>0&&(console.log(this.atpi,this.arrayTrackPoints),this.arrayTrackPoints.pop(),this.atpi-=1,this.atpi>0&&this.arrayTrackPoints[this.atpi-1].pop(),this.draw())}objRes(){this.object=new f}}const w={class:"onCanvas"},C=k({__name:"IndexPage",setup(l){const e=c(null),t=c(new d(e.value));return g(()=>{e.value&&(t.value=new d(e.value),t.value.resizeCanvas(),window.canvas=t.value),window.addEventListener("resize",t.value.resizeCanvas),window.addEventListener("keydown",i=>{["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"].includes(i.key)&&i.preventDefault()})}),x(()=>{delete window.canvas}),(i,s)=>(v(),b("div",{class:"canvas-container",onKeydown:s[12]||(s[12]=o=>t.value.object.move(o,t.value))},[r("div",w,[r("button",{class:"button",onClick:s[0]||(s[0]=(...o)=>t.value.centerButton&&t.value.centerButton(...o))}," center "),r("button",{class:h(["button buttons",{button_active:t.value?.isMoveButtonClicked}]),onClick:s[1]||(s[1]=o=>t.value.moveButtonClick())}," move ",2),r("button",{class:h(["button buttons",{button_active:t.value?.isDrawButtonClicked}]),onClick:s[2]||(s[2]=o=>t.value.drawButtonClick())}," draw ",2),r("button",{class:"button buttons",onClick:s[3]||(s[3]=(...o)=>t.value.undoButton&&t.value.undoButton(...o))}," undo "),r("button",{class:h(["button buttons",{button_active:t.value?.object.buttonClicked}]),onClick:s[4]||(s[4]=o=>t.value.object.buttonClick(t.value))}," object ",2),r("button",{class:h(["button buttons",{button_active:t.value?.object.runButtonClicked}]),style:u({display:t.value?.object.buttonClicked?"inline-block":"none"}),onClick:s[5]||(s[5]=o=>t.value.object.runButtonClick(t.value))}," run ",6),r("button",{class:"button buttons",style:u({display:t.value?.object.buttonClicked?"inline-block":"none"}),onClick:s[6]||(s[6]=o=>t.value.objRes())}," reset ",4)]),r("canvas",{onWheel:s[7]||(s[7]=(...o)=>t.value.onWheel&&t.value.onWheel(...o)),onMousedown:s[8]||(s[8]=(...o)=>t.value.onMouseDown&&t.value.onMouseDown(...o)),onMouseup:s[9]||(s[9]=(...o)=>t.value.onMouseUp&&t.value.onMouseUp(...o)),onMouseleave:s[10]||(s[10]=(...o)=>t.value.onMouseUp&&t.value.onMouseUp(...o)),onMousemove:s[11]||(s[11]=(...o)=>t.value.onMouseMove&&t.value.onMouseMove(...o)),ref_key:"refcanvas",ref:e},null,544)],32))}}),p=(l,e)=>{const t=l.__vccOpts||l;for(const[i,s]of e)t[i]=s;return t},M=p(C,[["__scopeId","data-v-a4ae2df8"]]);export{M as default};
