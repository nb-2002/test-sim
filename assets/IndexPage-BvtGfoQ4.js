import{d as T,r as f,o as Y,a as D,c as C,b as r,e as X,n as k,f as x,F as S,g as R,h as U,i as p,j as w,t as I,w as M,k as j,v as m}from"./index-ylxzaIZ-.js";class B{sensorCoord=[[0,25],[33,25],[66,25],[100,25]];sensorSensed=[!1,!1,!1,!1];operation=[[[!1,!0,!0,!1],[!0,!0,!1,!1],[!0,!1,!1,!1],[!1,!0,!1,!1],[!1,!0,!0,!0],[!1,!0,!1,!0],[!0,!0,!0,!0]],[[!1,!0,!0,!1],[!1,!1,!0,!0],[!1,!1,!1,!0],[!1,!1,!0,!1],[!0,!0,!0,!1],[!0,!1,!0,!1],[!0,!0,!0,!0]],[[!0,!1,!1,!0],[!1,!1,!1,!1]]];objectRect=[[0,0],[100,0],[100,50],[0,50]];width=100;height=50;buttonClicked=!1;isPlaced=!1;runButtonClicked=!1;editButtonClicked=!1;lastRot=0;constructor(t=[[0,25],[33,25],[66,25],[100,25]],e=[[[!1,!0,!0,!1],[!0,!0,!1,!1],[!0,!1,!1,!1],[!1,!0,!1,!1],[!1,!0,!0,!0],[!1,!0,!1,!0],[!0,!0,!0,!0]],[[!1,!0,!0,!1],[!1,!1,!0,!0],[!1,!1,!1,!0],[!1,!1,!0,!1],[!0,!0,!0,!1],[!0,!1,!0,!1],[!0,!0,!0,!0]],[[!0,!1,!1,!0],[!1,!1,!1,!1]]]){this.sensorCoord=t,this.operation=e,this.objectRect=[[0,0],[100,0],[100,50],[0,50]],this.buttonClicked=!1,this.isPlaced=!1,this.runButtonClicked=!1}drawObject(t){if(t.context&&this.isPlaced){t.context.save(),t.context.beginPath(),t.context.strokeStyle="#505050",t.context.lineWidth=2;for(const[e,i]of this.objectRect.entries())e==0?t.context.moveTo(i[0],i[1]):t.context.lineTo(i[0],i[1]),e==3&&t.context.lineTo(this.objectRect[0][0],this.objectRect[0][1]);t.context.stroke(),t.context.closePath(),t.context.beginPath(),t.context.fillStyle="#11aa11";for(const e of[this.objectRect])t.context.arc((e[1][0]+e[0][0])/2,(e[1][1]+e[0][1])/2,4,0,Math.PI*2);t.context.fill(),t.context.closePath();for(const e of this.sensorCoord)t.context.beginPath(),t.context.fillStyle="#1111aa",t.context.arc(e[0],e[1],2,0,Math.PI*2),t.context.fill(),t.context.closePath();t.context.restore()}}buttonClick(t,e){t.canvas&&(this.buttonClicked=!this.buttonClicked,this.runButtonClicked=!1,t.isMoveButtonClicked=!1,t.isDrawButtonClicked=!1,this.editButtonClicked&&this.edit(e),this.isPlaced||(this.isPlaced=!0,this.translate(Math.floor(t.canvas.width/50)/2*50-this.width/2,Math.floor(t.canvas.height/50)/2*50-this.height/2),t.draw()))}edit(t){this.runButtonClicked||(this.editButtonClicked=!this.editButtonClicked,t.style.zIndex=this.editButtonClicked?"2":"-1")}runButtonClick(t,e){this.runButtonClicked=!this.runButtonClicked,this.runButtonClicked&&this.run(t,e)}move(t,e){if(console.log(t),e.object.buttonClicked){const i=[[0,-1],[1,0],[0,1],[-1,0],[0,-10],[10,0],[0,10],[-10,0],[0,-100],[100,0],[0,100],[-100,0]];for(const[l,u]of["ArrowUp","ArrowRight","ArrowDown","ArrowLeft","w","d","s","a","W","D","S","A"].entries())u==t.key&&this.translate(i[l][0],i[l][1]);const s=[-1,1,-10,10];for(const[l,u]of[",",".","<",">"].entries())u==t.key&&this.rotate(s[l]);e.draw()}}run(t,e){e.style.zIndex="-1";const i=setInterval(()=>{this.check(t),this.left(),this.right(),t.draw(),(!(this.sensorSensed[0]||this.sensorSensed[1]||this.sensorSensed[2]||this.sensorSensed[3])||!this.runButtonClicked)&&(clearInterval(i),this.editButtonClicked&&(e.style.zIndex="2"),this.runButtonClicked=!1)},10)}check(t){for(const[i,s]of this.sensorCoord.entries()){const l=t.context.getImageData(s[0]*t.scale+t.originX,s[1]*t.scale+t.originY,1,1);(l.data[0]==16||l.data[0]==17)&&(l.data[1]==16||l.data[1]==17)&&(l.data[2]==16||l.data[2]==17)?this.sensorSensed[i]=!0:this.sensorSensed[i]=!1}let e=!1;for(const i of this.operation[2]){let s=0;for(const[l,u]of i.entries())u==this.sensorSensed[l]&&s++;if(s==4){e=!0;break}}e&&this.rotate(this.lastRot)}left(){let t=!1;for(const e of this.operation[0]){let i=0;for(const[s,l]of e.entries())l==this.sensorSensed[s]&&i++;if(i==4){t=!0;break}}t&&(this.rotate(-1),this.lastRot=-1)}right(){let t=!1;for(const e of this.operation[1]){let i=0;for(const[s,l]of e.entries())l==this.sensorSensed[s]&&i++;if(i==4){t=!0;break}}t&&(this.rotate(1),this.lastRot=1)}translate(t,e){for(const i of this.objectRect)i[0]+=t,i[1]+=e;for(const i of this.sensorCoord)i[0]+=t,i[1]+=e}rotate(t){const e=t*Math.PI/180;for(const i of[this.objectRect]){const s=t>0?[(i[1][0]+i[2][0])/2,(i[1][1]+i[2][1])/2]:[(i[0][0]+i[3][0])/2,(i[0][1]+i[3][1])/2];for(const[l,u]of i.entries()){const a=[u[0]-s[0],u[1]-s[1]];i[l]=[s[0]+a[0]*Math.cos(e)-a[1]*Math.sin(e),s[1]+a[0]*Math.sin(e)+a[1]*Math.cos(e)]}for(const[l,u]of this.sensorCoord.entries()){const a=[u[0]-s[0],u[1]-s[1]];this.sensorCoord[l]=[s[0]+a[0]*Math.cos(e)-a[1]*Math.sin(e),s[1]+a[0]*Math.sin(e)+a[1]*Math.cos(e)]}}}}class g{canvas=null;context=null;scale=1;originX=0;originY=0;isDragging=!1;lastX=0;lastY=0;isMoveButtonClicked=!1;isDrawButtonClicked=!1;isTrackPointDragged=!1;arrayTrackPoints=[[[]]];atpi=0;object=new B;constructor(t){this.canvas=t}resizeCanvas(){this.canvas&&(this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.draw())}onWheel(t){t.preventDefault();const e=t.deltaY<0?1.1:.9;this.scale*=e;const i=t.clientX,s=t.clientY;this.originX=i-(i-this.originX)*e,this.originY=s-(s-this.originY)*e,this.draw()}onMouseDown(t){if(this.isDragging=!0,this.lastX=t.clientX,this.lastY=t.clientY,this.isDrawButtonClicked){const e=(this.lastX-this.originX)/this.scale,i=(this.lastY-this.originY)/this.scale;this.atpi==0?(this.arrayTrackPoints.length==0?this.arrayTrackPoints.push([[e,i]]):(this.arrayTrackPoints[0][0].push(e),this.arrayTrackPoints[0][0].push(i)),this.atpi++):(this.arrayTrackPoints[this.atpi-1].length<=2&&this.arrayTrackPoints[this.atpi-1].push([e,i]),this.arrayTrackPoints.push([[e,i]]),this.atpi++),this.draw()}}onMouseMove(t){if(this.isDragging&&this.isMoveButtonClicked){const e=t.clientX-this.lastX,i=t.clientY-this.lastY;this.originX+=e,this.originY+=i,this.lastX=t.clientX,this.lastY=t.clientY,this.draw()}this.isDragging&&this.isDrawButtonClicked&&(this.isTrackPointDragged=!0,this.lastX=t.clientX,this.lastY=t.clientY,this.draw())}onMouseUp(){this.isDragging=!1,this.isTrackPointDragged&&this.arrayTrackPoints[this.atpi-1].push([(this.lastX-this.originX)/this.scale,(this.lastY-this.originY)/this.scale]),this.isTrackPointDragged=!1}draw(){this.canvas&&(this.context=this.canvas.getContext("2d",{willReadFrequently:!0}))&&(this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.translate(this.originX,this.originY),this.context.scale(this.scale,this.scale),this.drawGrid(),this.drawAxis(),this.object.drawObject(this),this.drawTrack(),this.context.restore())}drawGrid(){if(this.context){const t=50*this.scale;this.context.strokeStyle="#ccc",this.context.lineWidth=this.scale>5?1:this.scale<.2?4:2;for(let e=(Math.floor(-this.originX/t)*t-(Math.floor(this.canvas.width/50)%2?t/2:0))/this.scale;e<(this.canvas.width-this.originX)/this.scale;e+=t/this.scale)this.context.beginPath(),this.context.moveTo(e,-this.originY/this.scale),this.context.lineTo(e,(this.canvas.height-this.originY)/this.scale),this.context.stroke(),this.context.closePath();for(let e=(Math.floor(-this.originY/t)*t-(Math.floor(this.canvas.height/50)%2?t/2:0))/this.scale;e<(this.canvas.height-this.originY)/this.scale;e+=t/this.scale)this.context.beginPath(),this.context.moveTo(-this.originX/this.scale,e),this.context.lineTo((this.canvas.width-this.originX)/this.scale,e),this.context.stroke(),this.context.closePath()}}drawAxis(){this.context&&(this.context.strokeStyle="#a0a0a0",this.context.lineWidth=3,this.context.beginPath(),this.context.moveTo(Math.floor(this.canvas.width/50)/2*50,-this.originY/this.scale),this.context.lineTo(Math.floor(this.canvas.width/50)/2*50,(this.canvas.height-this.originY)/this.scale),this.context.moveTo(-this.originX/this.scale,Math.floor(this.canvas.height/50)/2*50),this.context.lineTo((this.canvas.width-this.originX)/this.scale,Math.floor(this.canvas.height/50)/2*50),this.context.stroke(),this.context.closePath())}drawTrack(){if(this.context)for(const[t,e]of this.arrayTrackPoints.entries()){if(this.isTrackPointDragged&&t==this.atpi-1){this.context.beginPath(),this.context.arc((this.lastX-this.originX)/this.scale,(this.lastY-this.originY)/this.scale,5,0,Math.PI*2),this.context.fillStyle="#1111aa",this.context.fill(),this.context.closePath();continue}e.length==2?(this.context.strokeStyle="#111111",this.context.lineWidth=50,this.context.beginPath(),this.context.moveTo(e[0][0],e[0][1]),this.context.lineTo(e[1][0],e[1][1]),this.context.stroke(),this.context.closePath()):e.length==3&&(this.context.strokeStyle="#111111",this.context.lineWidth=50,this.context.beginPath(),this.context.moveTo(e[0][0],e[0][1]),this.context.quadraticCurveTo(e[1][0],e[1][1],e[2][0],e[2][1]),this.context.stroke(),this.context.closePath()),t>0&&t<this.atpi-1&&(this.context.beginPath(),this.context.arc(e[0][0],e[0][1],25,0,Math.PI*2),this.context.fillStyle="#111111",this.context.fill(),this.context.closePath())}}centerButton(){this.originX=0,this.originY=0,this.scale=1,this.draw()}moveButtonClick(t){this.object.runButtonClicked=!1,this.object.buttonClicked=!1,this.isDrawButtonClicked=!1,this.isMoveButtonClicked=!this.isMoveButtonClicked,this.object.editButtonClicked&&this.object.edit(t)}drawButtonClick(t){this.object.runButtonClicked=!1,this.object.buttonClicked=!1,this.isMoveButtonClicked=!1,this.isDrawButtonClicked=!this.isDrawButtonClicked,this.object.editButtonClicked&&this.object.edit(t)}undoButton(){this.atpi>0&&(console.log(this.atpi,this.arrayTrackPoints),this.arrayTrackPoints.pop(),this.atpi-=1,this.atpi>0&&this.arrayTrackPoints[this.atpi-1].pop(),this.draw())}clearButton(){this.atpi=0,this.arrayTrackPoints=[[[]]],this.draw()}objRes(t){if(this.object=new B,this.object.isPlaced=t,t){const e=Math.floor(this.canvas.width/50)/2*50-this.object.width/2,i=Math.floor(this.canvas.height/50)/2*50-this.object.height/2;this.object.translate(e,i)}this.draw()}}const W={class:"canvas-container"},z={class:"buttonDiv"},A={class:"flex"},V=["onSubmit"],$=["onUpdate:modelValue"],L=["onSubmit"],N=["onUpdate:modelValue"],O=T({__name:"IndexPage",setup(v){const t=f(["","","",""]),e=f(["","","",""]),i=f(null),s=f(new g(null)),l=f(null),u=f(null),a=f(new g(null)),d=(c,o)=>{const h=Math.floor(o.canvas.width/50)/2*50-o.object.width/2,n=Math.floor(o.canvas.height/50)/2*50-o.object.height/2;c?o.object.translate(h,n):o.object.translate(-h,-n)};Y(()=>{i.value&&(s.value=new g(i.value),s.value.resizeCanvas(),window.canvas=s.value),u.value&&(a.value=new g(u.value),a.value.object.isPlaced=!0,d(!0,a.value),a.value.draw()),window.addEventListener("resize",()=>{s.value.resizeCanvas()}),window.addEventListener("keydown",c=>{["ArrowUp","ArrowRight","ArrowDown","ArrowLeft"].includes(c.key)&&c.preventDefault()})}),D(()=>{delete window.canvas});const y=c=>{const o=t.value[c];d(!1,a.value),a.value.object.sensorCoord[c][0]=Number(o),s.value.object.sensorCoord=a.value.object.sensorCoord.map(h=>[...h]),s.value.object.objectRect=a.value.object.objectRect.map(h=>[...h]),d(!0,a.value),a.value.draw(),d(!0,s.value),s.value.draw()},P=c=>{const o=e.value[c];d(!1,a.value),a.value.object.sensorCoord[c][1]=Number(o),s.value.object.sensorCoord=a.value.object.sensorCoord.map(h=>[...h]),s.value.object.objectRect=a.value.object.objectRect.map(h=>[...h]),d(!0,a.value),a.value.draw(),d(!0,s.value),s.value.draw()};return(c,o)=>{const h=U("router-view");return p(),C("div",{onKeydown:o[19]||(o[19]=n=>s.value.object.move(n,s.value))},[r("div",W,[r("canvas",{onWheel:o[0]||(o[0]=(...n)=>s.value.onWheel&&s.value.onWheel(...n)),onMousedown:o[1]||(o[1]=(...n)=>s.value.onMouseDown&&s.value.onMouseDown(...n)),onMouseup:o[2]||(o[2]=(...n)=>s.value.onMouseUp&&s.value.onMouseUp(...n)),onMouseleave:o[3]||(o[3]=(...n)=>s.value.onMouseUp&&s.value.onMouseUp(...n)),onMousemove:o[4]||(o[4]=(...n)=>s.value.onMouseMove&&s.value.onMouseMove(...n)),ref_key:"mainCanvas",ref:i},null,544),X(h)]),r("div",z,[r("button",{class:"button",onClick:o[5]||(o[5]=(...n)=>s.value.centerButton&&s.value.centerButton(...n))}," center "),r("button",{class:k(["button buttons",{button_active:s.value?.isMoveButtonClicked}]),onClick:o[6]||(o[6]=n=>s.value.moveButtonClick(l.value))}," move ",2),r("button",{class:k(["button buttons",{button_active:s.value?.isDrawButtonClicked}]),onClick:o[7]||(o[7]=n=>s.value.drawButtonClick(l.value))}," draw ",2),r("button",{class:"button buttons",onClick:o[8]||(o[8]=(...n)=>s.value.undoButton&&s.value.undoButton(...n))}," undo "),r("button",{class:"button buttons",onClick:o[9]||(o[9]=(...n)=>s.value.clearButton&&s.value.clearButton(...n))}," clear "),r("button",{class:k(["button buttons",{button_active:s.value?.object.buttonClicked}]),onClick:o[10]||(o[10]=n=>s.value.object.buttonClick(s.value,l.value))}," object ",2),r("button",{class:k(["button buttons",{button_active:s.value?.object.runButtonClicked}]),style:x({display:s.value?.object.buttonClicked?"inline-block":"none"}),onClick:o[11]||(o[11]=n=>s.value.object.runButtonClick(s.value,l.value))}," run ",6),r("button",{class:"button buttons",style:x({display:s.value?.object.buttonClicked?"inline-block":"none"}),onClick:o[12]||(o[12]=()=>{s.value.objRes(!1),a.value.objRes(!0),l.value.style.zIndex="-1"})}," reset ",4),r("button",{class:k(["button buttons",{button_active:s.value?.object.editButtonClicked}]),style:x({display:s.value?.object.buttonClicked?"inline-block":"none"}),onClick:o[13]||(o[13]=n=>s.value.object.edit(l.value))}," edit ",6)]),r("div",{class:"side_bar",ref_key:"sideBar",ref:l},[o[22]||(o[22]=r("div",null,[r("h3",null,"edit object")],-1)),r("canvas",{style:{width:"500px",height:"250px"},onWheel:o[14]||(o[14]=(...n)=>a.value.onWheel&&a.value.onWheel(...n)),onMousedown:o[15]||(o[15]=(...n)=>a.value.onMouseDown&&a.value.onMouseDown(...n)),onMouseup:o[16]||(o[16]=(...n)=>a.value.onMouseUp&&a.value.onMouseUp(...n)),onMouseleave:o[17]||(o[17]=(...n)=>a.value.onMouseUp&&a.value.onMouseUp(...n)),onMousemove:o[18]||(o[18]=(...n)=>a.value.onMouseMove&&a.value.onMouseMove(...n)),ref_key:"subCanvas",ref:u},null,544),r("div",A,[(p(),C(S,null,R([1,2,3,4],n=>r("div",{class:"fcol",key:n},[w(" Sensor"+I(n)+" ",1),r("form",{onSubmit:M(b=>y(n-1),["prevent"])},[o[20]||(o[20]=w("X:")),j(r("input",{"onUpdate:modelValue":b=>t.value[n-1]=b,type:"text"},null,8,$),[[m,t.value[n-1]]])],40,V),r("form",{onSubmit:M(b=>P(n-1),["prevent"])},[o[21]||(o[21]=w("Y:")),j(r("input",{"onUpdate:modelValue":b=>e.value[n-1]=b,type:"text"},null,8,N),[[m,e.value[n-1]]])],40,L)])),64))])],512)],32)}}}),E=(v,t)=>{const e=v.__vccOpts||v;for(const[i,s]of t)e[i]=s;return e},q=E(O,[["__scopeId","data-v-5bc7d7f2"]]);export{q as default};
